<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salut 9 Â· Kapittel 4 Â· Paysage</title>

  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --card2:#0f1630;
      --text:#e9ecff;
      --muted:#b7c0ff;
      --accent:#8b7bff;
      --good:#47d18c;
      --bad:#ff5c7a;
      --line:rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 30% 0%, rgba(139,123,255,.25), transparent 60%),
        radial-gradient(900px 600px at 80% 20%, rgba(71,209,140,.18), transparent 55%),
        var(--bg);
      color:var(--text);
    }
    .container{max-width:980px;margin:0 auto;padding:18px 16px 60px}
    a{color:inherit;text-decoration:none}
    h1{margin:18px 0 8px; font-size:2rem}
    .subtitle{color:var(--muted); margin:0 0 16px}

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      gap:12px; padding:10px 12px;
      border:1px solid var(--line);
      background:rgba(18,26,51,.7);
      backdrop-filter: blur(10px);
      border-radius:16px;
      box-shadow: var(--shadow);
      position: sticky; top: 10px; z-index: 20;
    }
    .topbar .left, .topbar .right{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .pill{
      border:1px solid var(--line);
      background:rgba(15,22,48,.8);
      padding:6px 10px;
      border-radius:999px;
      font-weight:650;
      display:inline-flex; align-items:center; gap:8px;
    }
    .small{font-size:.92rem;color:var(--muted)}
    .grid{display:grid; gap:14px}
    .card{
      background: linear-gradient(180deg, rgba(18,26,51,.95), rgba(15,22,48,.95));
      border:1px solid var(--line);
      border-radius:18px;
      padding:14px;
      box-shadow: var(--shadow);
    }
    .card h2{margin:0 0 10px; font-size:1.2rem}
    hr.sep{border:none;border-top:1px dashed var(--line);margin:14px 0}

    .btn{
      cursor:pointer;
      border:none;
      background: linear-gradient(180deg, rgba(139,123,255,1), rgba(108,94,255,1));
      color:white;
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
    }
    .btn.secondary{
      background: rgba(255,255,255,.08);
      border:1px solid var(--line);
    }
    .btn:active{transform: translateY(1px)}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}

    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
    }
    .progressWrap{min-width:210px}
    .progressLabel{display:flex; justify-content:space-between; font-size:.9rem; color:var(--muted); margin-bottom:6px}
    .progressBar{
      height:10px; border-radius:999px; background: rgba(255,255,255,.10);
      border:1px solid var(--line); overflow:hidden;
    }
    .progressFill{height:100%; width:0%; background: linear-gradient(90deg, var(--good), var(--accent))}

    .feedback{
      margin-top:10px; padding:10px 12px; border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
    }
    .choice{
      width:100%;
      text-align:left;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      font-weight:750;
    }
    .choice:hover{background: rgba(255,255,255,.09)}
    .choice.selected{outline:2px solid rgba(139,123,255,.7)}
    .choice.correct{border-color:rgba(71,209,140,.8)}
    .choice.wrong{border-color:rgba(255,92,122,.8)}

    .input, select{
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      outline:none;
    }
    select{cursor:pointer}
    textarea{
      width:100%;
      min-height:140px;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      outline:none;
      resize: vertical;
    }
    .wordGrid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap:10px;
      margin-top:10px;
    }
    .wordCard{
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      border-radius:16px;
      padding:10px 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .wordMain{display:flex; flex-direction:column; gap:4px}
    .fr{font-weight:900}
    .no{color:var(--muted); font-size:.95rem}
    .tiny{font-size:.85rem; color:var(--muted)}
    .sparkle{display:inline-block; animation: pop .6s ease;}
    @keyframes pop{0%{transform:scale(.85);opacity:.4}100%{transform:scale(1);opacity:1}}

    .footerNav{display:flex; justify-content:space-between; gap:10px; margin-top:16px; flex-wrap:wrap}
  </style>
</head>

<body>
  <div class="container">

    <div class="topbar">
      <div class="left">
        <a class="pill" href="index.html">â† Til meny</a>
        <span class="pill">Salut 9 Â· Kapittel 4</span>
        <span class="pill">â­ XP: <span id="xp">0</span></span>
      </div>

      <div class="right">
        <span class="pill" id="badge">ğŸ¥‰ Paysage Starter</span>
        <div class="progressWrap">
          <div class="progressLabel">
            <span>Fremdrift</span>
            <strong id="pct">0%</strong>
          </div>
          <div class="progressBar"><div class="progressFill" id="fill"></div></div>
        </div>
      </div>
    </div>

    <h1>ğŸï¸ Paysage: landskap + gloser</h1>
    <p class="subtitle">LÃ¦r landskapsord, lytt til uttale, spill mini-quiz, bygg setninger og skriv om ferien din. Samle XP og badges! ğŸ</p>

    <div class="row" style="margin:10px 0 6px;">
      <a class="pill" href="meteo.html">â˜€ï¸ MÃ©tÃ©o</a>
      <a class="pill" href="passecompose.html">â³ PassÃ© composÃ©</a>
      <a class="pill" href="negation.html">ğŸš« NÃ©gation</a>
      <a class="pill" href="defi.html">ğŸ DÃ©fi</a>
    </div>

    <div class="grid">

      <section class="card">
        <h2>ğŸ¯ LÃ¦ringsmÃ¥l</h2>
        <div class="badge">âœ… Jeg kan gjenkjenne og bruke landskapsord pÃ¥ fransk</div>
        <div class="badge">âœ… Jeg kan skrive 6â€“10 setninger om ferie og sted</div>
        <hr class="sep">
        <div class="badge">ğŸ’¡ Tips: Bruk <strong>â€œLegg til i tekstenâ€</strong> i setningsbyggeren for Ã¥ bygge en ferdig tekst.</div>
      </section>

      <!-- 1) GLOSER -->
      <section class="card">
        <h2>1) Gloser ğŸ§ </h2>
        <div class="row">
          <button class="btn secondary" id="toggleNo">Vis/Skjul norsk</button>
          <button class="btn secondary" id="ttsToggle">Lesestemme: <span id="ttsState">AV</span></button>
          <button class="btn" id="claimVocab">Jeg har Ã¸vd pÃ¥ glosene âœ… (+15 XP)</button>
        </div>
        <div class="small" style="margin-top:8px;">
          Klikk pÃ¥ ğŸ”Š for Ã¥ hÃ¸re fransk (hvis nettleseren stÃ¸tter det). Skjul norsk for aktiv Ã¸ving.
        </div>

        <div class="wordGrid" id="wordGrid"></div>
        <div class="feedback" id="vocabMsg">Tips: PrÃ¸v Ã¥ si ordene hÃ¸yt â€“ det teller! ğŸ˜„</div>
      </section>

      <!-- 2) SPILL -->
      <section class="card">
        <h2>2) Spill ğŸ® Mini-quiz: Hva betyr ordet?</h2>
        <div class="row">
          <span class="pill">Poeng: <strong id="score">0</strong> / <span id="total">0</span></span>
          <button class="btn secondary" id="mode">Modus: <span id="modeTxt">FR â†’ NO</span></button>
          <button class="btn" id="newQ">Ny oppgave âœ</button>
          <button class="btn secondary" id="reset">Nullstill</button>
        </div>

        <div class="feedback">
          <div class="small">Finn riktig betydning:</div>
          <div style="font-size:1.1rem; font-weight:900; margin:6px 0 8px;" id="qPrompt">â€”</div>

          <div class="grid" id="qChoices"></div>

          <div class="row" style="margin-top:10px;">
            <button class="btn" id="check">Sjekk</button>
            <span class="small">Tips: Skift modus hvis du vil!</span>
          </div>

          <div class="feedback" id="qResult" style="margin-top:12px;">Svar og fÃ¥ XP! âœ¨</div>
        </div>

        <div class="small" style="margin-top:8px;">
          Differensiering: FRâ†’NO er enklere. NOâ†’FR er litt vanskeligere.
        </div>
      </section>

      <!-- 3) SETNINGSBYGGER -->
      <section class="card">
        <h2>3) Bygg setning ğŸ› ï¸</h2>
        <div class="small">Velg elementer og fÃ¥ en ferdig setning du kan lime inn i teksten din.</div>

        <hr class="sep">

        <div class="grid">
          <div class="card" style="padding:12px;">
            <h2 style="margin:0 0 10px;">A) Je suis allÃ©(e) â€¦ (Ãªtre) ğŸš¶</h2>
            <div class="row">
              <select id="A_place"><option value="">Velg stedâ€¦</option></select>
              <button class="btn secondary" id="A_make">Lag setning</button>
            </div>
          </div>

          <div class="card" style="padding:12px;">
            <h2 style="margin:0 0 10px;">B) Jâ€™ai â€¦ (avoir) ğŸ¬</h2>
            <div class="row">
              <select id="B_verb"><option value="">Velg aktivitetâ€¦</option></select>
              <select id="B_where"><option value="">Hvor?</option></select>
              <button class="btn secondary" id="B_make">Lag setning</button>
            </div>
          </div>

          <div class="card" style="padding:12px;">
            <h2 style="margin:0 0 10px;">C) Il y avait / Câ€™Ã©tait â€¦ (beskrivelse) ğŸŒ¤ï¸</h2>
            <div class="row">
              <select id="C_desc"><option value="">Velg beskrivelseâ€¦</option></select>
              <button class="btn secondary" id="C_make">Lag setning</button>
            </div>
          </div>

          <div class="card" style="padding:12px;">
            <h2 style="margin:0 0 10px;">D) Opinion + grunn ğŸ’¬</h2>
            <div class="row">
              <select id="D_op"><option value="">Velg meningâ€¦</option></select>
              <select id="D_reason"><option value="">Velg grunnâ€¦</option></select>
              <button class="btn secondary" id="D_make">Lag setning</button>
            </div>
          </div>
        </div>

        <hr class="sep">

        <div class="feedback" id="built">Setningen din dukker opp her ğŸ™‚</div>

        <div class="row" style="margin-top:10px;">
          <button class="btn" id="addToText">Legg til i teksten â• (+2 XP)</button>
          <button class="btn secondary" id="copyBuilt">Kopier setning</button>
          <button class="btn secondary" id="clearBuilt">TÃ¸m setning</button>
        </div>
      </section>

      <!-- 4) PRODUKSJON -->
      <section class="card">
        <h2>4) Produksjon âœï¸ Kreativ skriveoppgave</h2>
        <div class="row">
          <button class="btn secondary" id="saveLocal">Lagre lokalt</button>
          <button class="btn secondary" id="loadLocal">Hent lagret</button>
          <button class="btn secondary" id="clearText">TÃ¸m</button>
        </div>

        <div class="small" style="margin-top:10px;">
          Skriv om ferien din: <strong>6â€“10 setninger</strong>. Bruk minst <strong>5 landskapsord</strong> fra ordbanken.
        </div>

        <hr class="sep">

        <div class="row">
          <span class="small">Velg nivÃ¥ (differensiering):</span>
          <select id="level">
            <option value="1">NivÃ¥ 1: korte setninger + mye stÃ¸tte</option>
            <option value="2" selected>NivÃ¥ 2: normaltekst</option>
            <option value="3">NivÃ¥ 3: mer detalj + variasjon</option>
          </select>
          <button class="btn secondary" id="insertStarters">Sett inn setningsstartere</button>
        </div>

        <div style="margin-top:10px;">
          <textarea id="text" placeholder="Skriv herâ€¦"></textarea>
        </div>

        <div class="row" style="margin-top:10px;">
          <button class="btn" id="checkVocab">Sjekk: bruker jeg 5 gloser? ğŸ”</button>
          <button class="btn secondary" id="copyText">Kopier tekst</button>
          <button class="btn secondary" id="bonus20">Jeg skrev 10+ setninger âœ… (+20 XP)</button>
        </div>

        <div class="feedback" id="prodMsg">
          Obs: â€œLagre lokaltâ€ lagrer kun i din egen nettleser pÃ¥ denne enheten (ingen innlogging).
        </div>
      </section>

    </div>

    <div class="footerNav">
      <a class="pill" href="meteo.html">â† La mÃ©tÃ©o</a>
      <a class="pill" href="defi.html">Neste: DÃ©fi final â†’</a>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    // ---------- smÃ¥ helper ----------
    function escapeHtml(str){
      return String(str)
        .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;").replace(/'/g,"&#039;");
    }
    function flash(el, html, kind){
      el.innerHTML = html;
      el.style.borderColor =
        kind === "good" ? "rgba(71,209,140,.7)" :
        kind === "bad"  ? "rgba(255,92,122,.7)" :
        "rgba(255,255,255,.18)";
    }
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }
    function sentenceCount(text){
      const t = (text||"").trim();
      if(!t) return 0;
      // veldig enkel setningsteller
      return t.split(/[.!?]+/).map(s=>s.trim()).filter(Boolean).length;
    }
    function normalize(s){
      return (s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
    }

    // ---------- PROGRESJON / XP ----------
    const LS_KEY = "chap4_paysage_progress_v2";
    function loadState(){
      try{ return JSON.parse(localStorage.getItem(LS_KEY)) || { xp:0, done:{}, quiz:{best:0} }; }
      catch(e){ return { xp:0, done:{}, quiz:{best:0} }; }
    }
    function saveState(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }
    let state = loadState();

    function addXP(amount){
      state.xp = Math.max(0, (state.xp||0) + amount);
      saveState(state);
      renderHeader();
    }
    function markDone(id){
      state.done = state.done || {};
      state.done[id] = true;
      saveState(state);
      renderHeader();
    }
    function calcProgress(ids){
      const done = state.done || {};
      const total = ids.length;
      const doneCount = ids.filter(id => done[id]).length;
      const pct = total ? Math.round((doneCount/total)*100) : 0;
      return { pct, doneCount, total };
    }

    const TASKS = ["pay_open","pay_vocab","pay_quiz","pay_builder","pay_write","pay_bonus"];

    const xpEl = document.getElementById("xp");
    const badgeEl = document.getElementById("badge");
    const pctEl = document.getElementById("pct");
    const fillEl = document.getElementById("fill");

    function renderHeader(){
      xpEl.textContent = state.xp || 0;

      const xp = state.xp || 0;
      if(xp >= 140) badgeEl.textContent = "ğŸ† Paysage LÃ©gende";
      else if(xp >= 95) badgeEl.textContent = "ğŸ¥‡ Paysage Ninja";
      else if(xp >= 55) badgeEl.textContent = "ğŸ¥ˆ Paysage Pro";
      else badgeEl.textContent = "ğŸ¥‰ Paysage Starter";

      const { pct } = calcProgress(TASKS);
      pctEl.textContent = pct + "%";
      fillEl.style.width = pct + "%";
    }

    setTimeout(()=>markDone("pay_open"), 400);
    renderHeader();

    // ---------- ORDBANK + TTS ----------
    const WORDS = [
      { fr:"la montagne", no:"fjellet", emoji:"â›°ï¸" },
      { fr:"la mer", no:"havet", emoji:"ğŸŒŠ" },
      { fr:"la plage", no:"stranden", emoji:"ğŸ–ï¸" },
      { fr:"la forÃªt", no:"skogen", emoji:"ğŸŒ²" },
      { fr:"le lac", no:"innsjÃ¸en", emoji:"ğŸï¸" },
      { fr:"la riviÃ¨re", no:"elva", emoji:"ğŸï¸" },
      { fr:"la campagne", no:"bygda", emoji:"ğŸŒ¾" },
      { fr:"la ville", no:"byen", emoji:"ğŸ™ï¸" },
      { fr:"le village", no:"landsbyen", emoji:"ğŸ˜ï¸" },
      { fr:"lâ€™Ã®le", no:"Ã¸ya", emoji:"ğŸï¸" },
      { fr:"le dÃ©sert", no:"Ã¸rkenen", emoji:"ğŸœï¸" },
      { fr:"la vallÃ©e", no:"dalen", emoji:"ğŸ”ï¸" }
    ];

    const wordGrid = document.getElementById("wordGrid");
    const toggleNoBtn = document.getElementById("toggleNo");
    const ttsBtn = document.getElementById("ttsToggle");
    const ttsStateEl = document.getElementById("ttsState");
    const vocabMsg = document.getElementById("vocabMsg");
    const claimVocabBtn = document.getElementById("claimVocab");

    let showNo = true;
    let ttsOn = false;

    function speakFR(text){
      if(!ttsOn) return;
      if(!("speechSynthesis" in window)) {
        flash(vocabMsg, "Denne nettleseren stÃ¸tter ikke lesestemme (TTS).", "bad");
        return;
      }
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "fr-FR";
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(u);
    }

    function renderWords(){
      wordGrid.innerHTML = "";
      WORDS.forEach(w=>{
        const div = document.createElement("div");
        div.className = "wordCard";
        div.innerHTML = `
          <div class="wordMain">
            <div class="fr">${escapeHtml(w.emoji)} ${escapeHtml(w.fr)}</div>
            <div class="no" style="${showNo ? "" : "display:none"}">${escapeHtml(w.no)}</div>
            <div class="tiny">Klikk ğŸ”Š for fransk</div>
          </div>
          <button class="btn secondary" style="padding:8px 10px" aria-label="uttale">ğŸ”Š</button>
        `;
        div.querySelector("button").onclick = ()=>{
          speakFR(w.fr);
          flash(vocabMsg, `ğŸ”Š Uttale: <strong>${escapeHtml(w.fr)}</strong> <span class="sparkle">(+1 XP)</span>`, "good");
          addXP(1);
        };
        wordGrid.appendChild(div);
      });
    }
    renderWords();

    toggleNoBtn.onclick = ()=>{
      showNo = !showNo;
      renderWords();
      flash(vocabMsg, showNo ? "Norsk vises âœ…" : "Norsk skjult ğŸ™ˆ (bra Ã¸ving!)", "info");
    };

    ttsBtn.onclick = ()=>{
      ttsOn = !ttsOn;
      ttsStateEl.textContent = ttsOn ? "PÃ…" : "AV";
      flash(vocabMsg, ttsOn ? "Lesestemme er PÃ… ğŸ”Š" : "Lesestemme er AV", "info");
    };

    claimVocabBtn.onclick = ()=>{
      if(state.done && state.done["pay_vocab"]){
        flash(vocabMsg, "Allerede tatt! ğŸ‰", "good");
        return;
      }
      addXP(15);
      markDone("pay_vocab");
      flash(vocabMsg, `ğŸ‰ Super! Du har Ã¸vd pÃ¥ glosene <span class="sparkle">(+15 XP)</span>`, "good");
    };

    // ---------- MINI-QUIZ ----------
    const scoreEl = document.getElementById("score");
    const totalEl = document.getElementById("total");
    const modeBtn = document.getElementById("mode");
    const modeTxt = document.getElementById("modeTxt");
    const newQBtn = document.getElementById("newQ");
    const resetBtn = document.getElementById("reset");
    const checkBtn = document.getElementById("check");
    const qPromptEl = document.getElementById("qPrompt");
    const qChoicesEl = document.getElementById("qChoices");
    const qResultEl = document.getElementById("qResult");

    let modeFRtoNO = true; // true = FR->NO, false = NO->FR
    let current = null;
    let selected = null;
    let score = 0;

    totalEl.textContent = WORDS.length;

    function makeQuestion(){
      selected = null;
      qChoicesEl.innerHTML = "";
      current = WORDS[Math.floor(Math.random()*WORDS.length)];

      const prompt = modeFRtoNO ? current.fr : current.no;
      qPromptEl.textContent = prompt;

      // 4 alternativer
      let pool = shuffle(WORDS).filter(w => w !== current).slice(0, 3);
      pool.push(current);
      pool = shuffle(pool);

      pool.forEach(w => {
        const text = modeFRtoNO ? w.no : w.fr;
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.type = "button";
        btn.textContent = text;
        btn.onclick = () => {
          selected = w;
          [...qChoicesEl.querySelectorAll(".choice")].forEach(x => x.classList.remove("selected"));
          btn.classList.add("selected");
        };
        qChoicesEl.appendChild(btn);
      });

      flash(qResultEl, "Velg et alternativ og trykk <strong>Sjekk</strong>.", "info");
    }

    function resetQuiz(){
      score = 0;
      scoreEl.textContent = score;
      makeQuestion();
      flash(qResultEl, "Nullstilt. Lykke til!", "info");
    }

    modeBtn.onclick = () => {
      modeFRtoNO = !modeFRtoNO;
      modeTxt.textContent = modeFRtoNO ? "FR â†’ NO" : "NO â†’ FR";
      makeQuestion();
    };

    newQBtn.onclick = () => makeQuestion();

    resetBtn.onclick = () => resetQuiz();

    checkBtn.onclick = () => {
      if(!selected){
        flash(qResultEl, "Velg et svar fÃ¸rst ğŸ™‚", "bad");
        return;
      }

      // marker riktig/feil visuelt
      const btns = [...qChoicesEl.querySelectorAll(".choice")];
      btns.forEach(b => b.classList.remove("correct","wrong"));
      btns.forEach(b => {
        const label = b.textContent;
        const isCorrectLabel = modeFRtoNO ? current.no : current.fr;
        if(label === isCorrectLabel) b.classList.add("correct");
      });

      if(selected === current){
        score += 1;
        scoreEl.textContent = score;
        addXP(4);
        flash(qResultEl, `âœ… Riktig! <span class="sparkle">(+4 XP)</span>`, "good");
      }else{
        addXP(1);
        flash(qResultEl, `âŒ Nesten. Riktig er: <strong>${escapeHtml(modeFRtoNO ? current.no : current.fr)}</strong> <span class="sparkle">(+1 XP)</span>`, "bad");
      }

      // progress: ferdig nÃ¥r eleven har 6 riktige
      if(score >= 6 && !(state.done && state.done["pay_quiz"])){
        markDone("pay_quiz");
        flash(qResultEl, `ğŸ‰ Du klarte 6 riktige! Oppgave 2 registrert som ferdig âœ…`, "good");
      }

      setTimeout(makeQuestion, 850);
    };

    makeQuestion();

    // ---------- SETNINGSBYGGER ----------
    const builtEl = document.getElementById("built");
    const addToTextBtn = document.getElementById("addToText");
    const copyBuiltBtn = document.getElementById("copyBuilt");
    const clearBuiltBtn = document.getElementById("clearBuilt");

    const A_place = document.getElementById("A_place");
    const B_verb  = document.getElementById("B_verb");
    const B_where = document.getElementById("B_where");
    const C_desc  = document.getElementById("C_desc");
    const D_op    = document.getElementById("D_op");
    const D_reason= document.getElementById("D_reason");

    const A_make  = document.getElementById("A_make");
    const B_make  = document.getElementById("B_make");
    const C_make  = document.getElementById("C_make");
    const D_make  = document.getElementById("D_make");

    const places = WORDS.map(w => w.fr);
    const wheres = ["Ã  la montagne","Ã  la plage","Ã  la mer","au lac","dans la forÃªt","Ã  la campagne","en ville","au village","sur lâ€™Ã®le","dans la vallÃ©e"];
    const verbs = ["fait du vÃ©lo","pris des photos","mangÃ© une glace","fait une randonnÃ©e","nagÃ©","visitÃ© un musÃ©e","jouÃ© au football","fait du shopping"];
    const descs = ["Câ€™Ã©tait magnifique.","Il faisait beau.","Il faisait chaud.","Il y avait beaucoup de monde.","Câ€™Ã©tait calme.","Câ€™Ã©tait intÃ©ressant."];
    const ops = ["Jâ€™ai adorÃ©.","Jâ€™ai aimÃ©.","Je nâ€™ai pas aimÃ©.","Câ€™Ã©tait super."];
    const reasons = ["parce que câ€™Ã©tait beau.","parce que câ€™Ã©tait amusant.","parce que câ€™Ã©tait trop chaud.","parce que câ€™Ã©tait cher.","parce que câ€™Ã©tait calme."];

    function fillSelect(sel, arr){
      arr.forEach(x=>{
        const opt = document.createElement("option");
        opt.value = x;
        opt.textContent = x;
        sel.appendChild(opt);
      });
    }
    fillSelect(A_place, places);
    fillSelect(B_verb, verbs);
    fillSelect(B_where, wheres);
    fillSelect(C_desc, descs);
    fillSelect(D_op, ops);
    fillSelect(D_reason, reasons);

    let built = "";

    function setBuilt(s){
      built = s;
      builtEl.innerHTML = `<strong>${escapeHtml(built || "Setningen din dukker opp her ğŸ™‚")}</strong>`;
    }

    A_make.onclick = () => {
      if(!A_place.value) return setBuilt("Velg et sted fÃ¸rst ğŸ™‚");
      setBuilt(`Je suis allÃ©(e) Ã  ${A_place.value}.`);
      addXP(1);
    };
    B_make.onclick = () => {
      if(!B_verb.value || !B_where.value) return setBuilt("Velg aktivitet + hvor ğŸ™‚");
      setBuilt(`Jâ€™ai ${B_verb.value} ${B_where.value}.`);
      addXP(1);
    };
    C_make.onclick = () => {
      if(!C_desc.value) return setBuilt("Velg en beskrivelse ğŸ™‚");
      setBuilt(C_desc.value);
      addXP(1);
    };
    D_make.onclick = () => {
      if(!D_op.value || !D_reason.value) return setBuilt("Velg mening + grunn ğŸ™‚");
      setBuilt(`${D_op.value} ${D_reason.value}`);
      addXP(1);
    };

    copyBuiltBtn.onclick = async () => {
      if(!built) return;
      try{
        await navigator.clipboard.writeText(built);
        setBuilt(built + " âœ… Kopiert!");
      }catch(e){
        setBuilt(built + " (Kunne ikke kopiere her â€“ marker og kopier manuelt.)");
      }
    };

    clearBuiltBtn.onclick = () => setBuilt("");

    // marker oppgave 3 som ferdig nÃ¥r eleven legger til 3 setninger i teksten
    let builderAdds = 0;

    // ---------- PRODUKSJON ----------
    const textEl = document.getElementById("text");
    const prodMsg = document.getElementById("prodMsg");
    const levelEl = document.getElementById("level");

    const saveLocalBtn = document.getElementById("saveLocal");
    const loadLocalBtn = document.getElementById("loadLocal");
    const clearTextBtn = document.getElementById("clearText");
    const insertStartersBtn = document.getElementById("insertStarters");

    const checkVocabBtn = document.getElementById("checkVocab");
    const copyTextBtn = document.getElementById("copyText");
    const bonus20Btn = document.getElementById("bonus20");

    const TEXT_KEY = "chap4_paysage_text_v1";

    addToTextBtn.onclick = () => {
      if(!built) return setBuilt("Lag en setning fÃ¸rst ğŸ™‚");
      textEl.value = (textEl.value ? (textEl.value.trimEnd() + "\n") : "") + built;
      builderAdds += 1;
      addXP(2);
      if(builderAdds >= 3 && !(state.done && state.done["pay_builder"])){
        markDone("pay_builder");
        flash(prodMsg, "âœ… Oppgave 3 (setningsbygger) registrert som ferdig!", "good");
      }
    };

    saveLocalBtn.onclick = () => {
      localStorage.setItem(TEXT_KEY, textEl.value || "");
      flash(prodMsg, "âœ… Lagret lokalt pÃ¥ denne enheten.", "good");
    };

    loadLocalBtn.onclick = () => {
      textEl.value = localStorage.getItem(TEXT_KEY) || "";
      flash(prodMsg, "ğŸ“¥ Hentet lagret tekst.", "info");
    };

    clearTextBtn.onclick = () => {
      if(!confirm("TÃ¸mme teksten?")) return;
      textEl.value = "";
      flash(prodMsg, "Tekst tÃ¸mt.", "info");
    };

    insertStartersBtn.onclick = () => {
      const lv = levelEl.value;
      let starters = "";
      if(lv === "1"){
        starters =
`Je suis allÃ©(e) Ã  â€¦
Jâ€™ai â€¦
Câ€™Ã©tait â€¦
Il y avait â€¦
Jâ€™ai aimÃ© â€¦ parce que â€¦
Je nâ€™ai pas aimÃ© â€¦ parce que â€¦`;
      }else if(lv === "2"){
        starters =
`Pendant les vacances, je suis allÃ©(e) Ã  â€¦
Jâ€™ai â€¦ et jâ€™ai â€¦
Câ€™Ã©tait â€¦, mais â€¦
Jâ€™ai adorÃ© â€¦ parce que â€¦
Ensuite, jâ€™ai â€¦`;
      }else{
        starters =
`Pendant les vacances, je suis allÃ©(e) Ã  â€¦
Dâ€™abord, jâ€™ai â€¦
Ensuite, jâ€™ai â€¦
Il y avait â€¦ et câ€™Ã©tait â€¦
Jâ€™ai aimÃ© â€¦ parce que â€¦ / Je nâ€™ai pas aimÃ© â€¦ parce que â€¦
Finalement, je suis rentrÃ©(e).`;
      }
      textEl.value = starters + "\n\n" + (textEl.value || "");
      flash(prodMsg, "âœ… Setningsstartere satt inn Ã¸verst.", "good");
      addXP(2);
    };

    checkVocabBtn.onclick = () => {
      const t = normalize(textEl.value);
      const hits = WORDS.filter(w => {
        const fr = normalize(w.fr);
        // smÃ¥ â€œsnilleâ€ treff
        const simple = fr.replace(/^la\s+|^le\s+|^lâ€™|^l'/,"");
        return t.includes(fr) || (simple && t.includes(simple));
      });

      const unique = new Set(hits.map(h => h.fr)).size;

      if(unique >= 5){
        addXP(10);
        markDone("pay_write");
        flash(prodMsg, `âœ… Bra! Du brukte ${unique} landskapsord. <span class="sparkle">(+10 XP)</span>`, "good");
      }else{
        flash(prodMsg, `Du har ${unique}/5 landskapsord. PrÃ¸v Ã¥ bruke minst 5 (fra gloselista).`, "bad");
      }
    };

    copyTextBtn.onclick = async () => {
      try{
        await navigator.clipboard.writeText(textEl.value || "");
        flash(prodMsg, "âœ… Teksten er kopiert.", "good");
      }catch(e){
        flash(prodMsg, "Kunne ikke kopiere automatisk her. Marker teksten og kopier manuelt.", "bad");
      }
    };

    bonus20Btn.onclick = () => {
      const n = sentenceCount(textEl.value);
      if(n < 10){
        flash(prodMsg, `Du har ca. ${n} setninger. Skriv litt mer fÃ¸r du tar bonus ğŸ™‚`, "bad");
        return;
      }
      if(state.done && state.done["pay_bonus"]){
        flash(prodMsg, "Bonus allerede tatt âœ…", "good");
        return;
      }
      addXP(20);
      markDone("pay_bonus");
      flash(prodMsg, `ğŸ‰ Bonus! 10+ setninger. <span class="sparkle">(+20 XP)</span>`, "good");
    };
  });
  </script>
</body>
</html>
