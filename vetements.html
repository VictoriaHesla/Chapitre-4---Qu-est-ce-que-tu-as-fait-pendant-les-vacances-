<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salut 9 ‚Äì Kap. 4: V√™tements</title>
  <style>
    :root{
      --bg:#0b1020;
      --card: rgba(255,255,255,.06);
      --line: rgba(255,255,255,.14);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.75);
      --good: rgba(55,214,122,.65);
      --bad: rgba(255,92,92,.65);
      --accent: rgba(122,162,255,.22);
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 800px at 20% 10%, rgba(122,162,255,.25), transparent 55%),
        radial-gradient(1200px 800px at 80% 20%, rgba(55,214,122,.18), transparent 55%),
        var(--bg);
      color: var(--text);
    }
    header{
      max-width: 1100px;
      margin: 0 auto;
      padding: 18px 16px 8px;
    }
    h1{ margin:0 0 6px; font-size:20px; }
    .sub{ margin:0; color:var(--muted); font-size:14px; line-height:1.35; }

    .wrap{
      max-width:1100px;
      margin: 0 auto;
      padding: 12px 16px 28px;
      display:grid;
      gap: 14px;
      grid-template-columns: 1fr 1fr;
      align-items:start;
    }
    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
    }

    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card h2{
      margin:0;
      padding: 12px 12px 10px;
      font-size: 16px;
      border-bottom: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.07), transparent);
    }
    .content{ padding: 12px; }

    .status{
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:12px;
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
      margin-bottom: 12px;
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    button, select, input[type="text"]{
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 10px;
      font-size: 14px;
      outline:none;
    }
    button{
      cursor:pointer;
      background: var(--accent);
      border-color: rgba(122,162,255,.35);
    }
    button.secondary{
      background: rgba(255,255,255,.06);
      border-color: var(--line);
    }

    .pill{
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.14);
      font-size: 12px;
      color: rgba(255,255,255,.82);
    }

    /* --- Color drag task --- */
    .twoCol{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items:start;
    }
    @media (max-width: 640px){
      .twoCol{ grid-template-columns: 1fr; }
    }

    .targets{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 12px;
    }
    .target{
      padding:10px;
      border:1px dashed rgba(255,255,255,.22);
      border-radius:14px;
      background: rgba(0,0,0,.14);
      min-height: 132px;
      outline: none;
    }
    .dot{
      width:74px;height:74px;border-radius:999px;
      margin: 0 auto 10px;
      border:1px solid rgba(255,255,255,.18);
    }
    .tHint{
      text-align:center;
      opacity:.7;
      font-size:12px;
    }
    .tAnswer{
      margin-top:8px;
      text-align:center;
      font-weight: 650;
      min-height: 22px;
    }

    .tiles{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
    }
    .tile{
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      touch-action:none; /* important for iPad drag */
      cursor: grab;
    }
    .tile.used{
      opacity:.55;
      background: rgba(255,255,255,.04);
      cursor: not-allowed;
    }
    .swatch{
      width:12px;height:12px;border-radius:99px;
      border:1px solid rgba(255,255,255,.22);
    }
    .dragProxy{
      position:fixed; left:0; top:0;
      z-index: 9999;
      pointer-events:none;
      opacity:.95;
    }

    /* --- Emoji glossary task --- */
    .grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 12px;
    }
    @media (max-width: 700px){
      .grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 430px){
      .grid{ grid-template-columns: 1fr; }
    }
    .ec{
      background: rgba(0,0,0,.14);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .emo{
      font-size: 40px;
      text-align:center;
      line-height:1;
    }
    .noHint{
      text-align:center;
      font-size: 12px;
      opacity: .78;
      margin-top: -6px;
      display:none;
    }
    .noHint.show{ display:block; }

    .fb{
      min-height: 18px;
      font-size: 12px;
      opacity: .9;
      text-align:center;
    }

    .mini{
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
      margin-top: 8px;
    }

    .colorPair{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .colorDotSmall{
      width:16px;height:16px;border-radius:99px;
      border: 1px solid rgba(255,255,255,.22);
      display:inline-block;
      vertical-align:middle;
    }
  </style>
</head>
<body>
<header>
  <h1>V√™tements ‚Äì interaktive oppgaver uten bilder</h1>
  <p class="sub">
    1) Dra franske farger til riktig prikk (iPad + PC). 2) Emoji-kl√¶r: skriv gloser og sjekk.
    Alt lagres lokalt i nettleseren.
  </p>
</header>

<main class="wrap">
  <!-- CARD 1: COLOR DRAG -->
  <section class="card">
    <h2>Oppgave 1: Dra fransk farge til riktig prikk</h2>
    <div class="content">
      <div id="colorStatus" class="status">Klar! Dra en brikke.</div>

      <div class="twoCol">
        <div>
          <div class="row" style="margin-bottom:10px;">
            <span class="pill">Fargeprikker</span>
          </div>
          <div id="colorTargets" class="targets"></div>
          <div class="mini">Tips: Brikkene blir ‚Äúgr√•‚Äù n√•r de er brukt riktig.</div>
        </div>

        <div>
          <div class="row" style="margin-bottom:10px;">
            <span class="pill">Ordbrikker</span>
          </div>
          <div id="colorTiles" class="tiles"></div>
          <div class="row" style="margin-top:12px;">
            <button id="colorReset" class="secondary" type="button">Nullstill</button>
            <button id="colorShuffle" type="button">Bland</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CARD 2: EMOJI GLOSER -->
  <section class="card">
    <h2>Oppgave 2: Emoji ‚Üí skriv glosen (inkl. farge + plagg)</h2>
    <div class="content">
      <div id="emojiStatus" class="status">
        Skriv fransk under hver emoji. Noen har ogs√• en fargeprikk ‚Äì skriv farge i samme svar.
        Eksempel: <b>un t-shirt rouge</b>.
      </div>

      <div class="row" style="margin-bottom:10px;">
        <button id="toggleNo" class="secondary" type="button">Vis norsk hint</button>
        <button id="emojiCheck" type="button">Sjekk</button>
        <button id="emojiHint" class="secondary" type="button">Hint (f√∏rste bokstav)</button>
        <button id="emojiReveal" class="secondary" type="button">Vis fasit</button>
        <button id="emojiReset" class="secondary" type="button">Nullstill</button>
      </div>

      <div id="emojiGrid" class="grid"></div>

      <div class="mini">
        Godtar sm√• variasjoner: store/sm√• bokstaver, ekstra mellomrom og aksenter (√©) blir ignorert i sjekk.
      </div>
    </div>
  </section>
</main>

<script>
(() => {
  // -----------------------
  // Shared: Colors
  // -----------------------
  const COLORS = [
    { fr:"marron", css:"#7a4a21" },
    { fr:"noir", css:"#111111" },
    { fr:"bleu", css:"#2f64ff" },
    { fr:"vert", css:"#2fbf6b" },
    { fr:"jaune", css:"#ffd400" },
    { fr:"gris", css:"#9aa3ad" },
    { fr:"rose", css:"#ff5bb8" },
    { fr:"violet", css:"#8a4dff" },
    { fr:"rouge", css:"#ff3b3b" },
    { fr:"orange", css:"#ff8a2f" },
    { fr:"blanc", css:"#f3f3f3" },
  ];
  const colorByFr = Object.fromEntries(COLORS.map(c => [c.fr, c.css]));

  function shuffle(arr){
    const a = arr.slice();
    for(let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i],a[j]] = [a[j],a[i]];
    }
    return a;
  }

  function norm(s){
    return (s || "")
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // remove accents
      .replace(/\s+/g, " ")
      .trim();
  }

  // ============================================================
  // TASK 1: Color drag (Pointer Events)
  // ============================================================
  const LS_COLOR = "salut9_vetements_color_drag_v2";
  const elTargets = document.getElementById("colorTargets");
  const elTiles = document.getElementById("colorTiles");
  const elColorStatus = document.getElementById("colorStatus");
  const btnColorReset = document.getElementById("colorReset");
  const btnColorShuffle = document.getElementById("colorShuffle");

  let colorState = loadJSON(LS_COLOR, {}); // { targetFr: tileFr }
  let currentOrder = shuffle(COLORS);

  function setColorStatus(text, kind){
    elColorStatus.textContent = text;
    elColorStatus.style.borderColor =
      kind === "good" ? "rgba(55,214,122,.55)" :
      kind === "bad" ? "rgba(255,92,92,.55)" :
      "rgba(255,255,255,.14)";
  }
  function saveColorState(){ localStorage.setItem(LS_COLOR, JSON.stringify(colorState)); }

  function renderColorTargets(){
    elTargets.innerHTML = "";
    COLORS.forEach(c => {
      const box = document.createElement("div");
      box.className = "target";
      box.dataset.targetFr = c.fr;

      const dot = document.createElement("div");
      dot.className = "dot";
      dot.style.background = c.css;

      const hint = document.createElement("div");
      hint.className = "tHint";
      hint.textContent = "Slipp ord her";

      const ans = document.createElement("div");
      ans.className = "tAnswer";
      ans.textContent = colorState[c.fr] ? colorState[c.fr] : "";

      box.appendChild(dot);
      box.appendChild(hint);
      box.appendChild(ans);
      elTargets.appendChild(box);
    });
  }

  function renderColorTiles(order){
    elTiles.innerHTML = "";
    order.forEach(c => {
      const used = Object.values(colorState).includes(c.fr);

      const tile = document.createElement("div");
      tile.className = "tile" + (used ? " used" : "");
      tile.dataset.tileFr = c.fr;

      const sw = document.createElement("span");
      sw.className = "swatch";
      sw.style.background = c.css;

      const txt = document.createElement("span");
      txt.textContent = c.fr;

      tile.appendChild(sw);
      tile.appendChild(txt);

      if(!used){
        tile.addEventListener("pointerdown", onColorDragStart);
      }
      elTiles.appendChild(tile);
    });
  }

  function evaluateColorsDone(){
    const done = COLORS.every(c => colorState[c.fr] === c.fr);
    if(done) setColorStatus("Fantastisk! Alle fargene er riktig üéâ", "good");
  }

  // Pointer drag
  let drag = null;

  function findColorTarget(x,y){
    const el = document.elementFromPoint(x,y);
    if(!el) return null;
    return el.closest("[data-target-fr]");
  }
  function moveProxy(x,y){
    if(!drag) return;
    drag.proxy.style.transform = `translate3d(${x - drag.offX}px, ${y - drag.offY}px, 0)`;
  }

  function onColorDragStart(e){
    if (e.button !== undefined && e.button !== 0) return;

    const tile = e.currentTarget;
    const fr = tile.dataset.tileFr;
    tile.setPointerCapture(e.pointerId);

    const rect = tile.getBoundingClientRect();
    const proxy = tile.cloneNode(true);
    proxy.classList.add("dragProxy");
    proxy.style.width = rect.width + "px";
    proxy.style.height = rect.height + "px";
    document.body.appendChild(proxy);

    drag = {
      fr, proxy, pid: e.pointerId,
      offX: e.clientX - rect.left,
      offY: e.clientY - rect.top
    };

    moveProxy(e.clientX, e.clientY);
    window.addEventListener("pointermove", onColorDragMove, { passive:false });
    window.addEventListener("pointerup", onColorDragEnd, { passive:false });
    window.addEventListener("pointercancel", onColorDragEnd, { passive:false });

    setColorStatus("Dra til riktig prikk‚Ä¶");
  }

  function onColorDragMove(e){
    if(!drag || e.pointerId !== drag.pid) return;
    e.preventDefault();
    moveProxy(e.clientX, e.clientY);

    document.querySelectorAll("[data-target-fr]").forEach(t => t.style.outline = "none");
    const t = findColorTarget(e.clientX, e.clientY);
    if(t) t.style.outline = "2px solid rgba(122,162,255,.6)";
  }

  function onColorDragEnd(e){
    if(!drag || e.pointerId !== drag.pid) return;
    e.preventDefault();

    document.querySelectorAll("[data-target-fr]").forEach(t => t.style.outline = "none");
    const target = findColorTarget(e.clientX, e.clientY);

    if(target){
      const targetFr = target.dataset.targetFr;
      const tileFr = drag.fr;

      if(targetFr === tileFr){
        colorState[targetFr] = tileFr;
        saveColorState();
        setColorStatus("Riktig! ‚úÖ", "good");
      }else{
        setColorStatus("Feil ‚Äì pr√∏v igjen ‚ùå", "bad");
      }

      renderColorTargets();
      renderColorTiles(currentOrder);
      evaluateColorsDone();
    }

    drag.proxy.remove();
    drag = null;
    window.removeEventListener("pointermove", onColorDragMove);
    window.removeEventListener("pointerup", onColorDragEnd);
    window.removeEventListener("pointercancel", onColorDragEnd);
  }

  btnColorReset.addEventListener("click", () => {
    colorState = {};
    saveColorState();
    renderColorTargets();
    renderColorTiles(currentOrder);
    setColorStatus("Nullstilt.");
  });
  btnColorShuffle.addEventListener("click", () => {
    currentOrder = shuffle(COLORS);
    renderColorTiles(currentOrder);
    setColorStatus("Blandet.");
  });

  function loadJSON(key, fallback){
    try{
      const raw = localStorage.getItem(key);
      return raw ? JSON.parse(raw) : fallback;
    }catch{ return fallback; }
  }

  // init task 1
  renderColorTargets();
  renderColorTiles(currentOrder);
  evaluateColorsDone();

  // ============================================================
  // TASK 2: Emoji glossary (with Norwegian hints + some color+clothing)
  // ============================================================
  const LS_EMOJI = "salut9_vetements_emoji_v2";
  const LS_EMOJI_HINT = "salut9_vetements_show_nohint_v1";

  const elEmojiGrid = document.getElementById("emojiGrid");
  const elEmojiStatus = document.getElementById("emojiStatus");
  const btnToggleNo = document.getElementById("toggleNo");
  const btnEmojiCheck = document.getElementById("emojiCheck");
  const btnEmojiHint = document.getElementById("emojiHint");
  const btnEmojiReveal = document.getElementById("emojiReveal");
  const btnEmojiReset = document.getElementById("emojiReset");

  // 12 oppgaver (8‚Äì12 √∏nsket, her 12)
  // Noen har fargeprikk => eleven skal skrive "plagg + farge"
  const EMOJI_WORDS = [
    { id:"tshirt",     emoji:"üëï", no:"t-skjorte", answer:"un t-shirt", color:"rouge" },
    { id:"pants",      emoji:"üëñ", no:"bukse",     answer:"un pantalon", color:"noir" },
    { id:"dress",      emoji:"üëó", no:"kjole",     answer:"une robe", color:"violet" },
    { id:"jacket",     emoji:"üß•", no:"jakke",     answer:"une veste", color:"bleu" },
    { id:"shoes",      emoji:"üëü", no:"sko",       answer:"des chaussures", color:"blanc" },
    { id:"socks",      emoji:"üß¶", no:"sokker",    answer:"des chaussettes", color:null },
    { id:"cap",        emoji:"üß¢", no:"caps",      answer:"une casquette", color:"vert" },
    { id:"scarf",      emoji:"üß£", no:"skjerf",    answer:"une √©charpe", color:"gris" },
    { id:"gloves",     emoji:"üß§", no:"hansker",   answer:"des gants", color:null },
    { id:"bag",        emoji:"üëú", no:"veske",     answer:"un sac", color:"marron" },
    { id:"sunglasses", emoji:"üï∂Ô∏è", no:"solbriller",answer:"des lunettes de soleil", color:null },
    { id:"skirt",      emoji:"üëö", no:"skj√∏rt",    answer:"une jupe", color:"rose" }, // emoji er topp, men oppgaven er ok
  ];

  let emojiState = loadJSON(LS_EMOJI, {}); // id -> inputText
  let showNoHint = (localStorage.getItem(LS_EMOJI_HINT) === "1");

  function setEmojiStatus(text, kind){
    elEmojiStatus.textContent = text;
    elEmojiStatus.style.borderColor =
      kind === "good" ? "rgba(55,214,122,.55)" :
      kind === "bad" ? "rgba(255,92,92,.55)" :
      "rgba(255,255,255,.14)";
  }

  function saveEmojiState(){
    localStorage.setItem(LS_EMOJI, JSON.stringify(emojiState));
  }

  function expectedAnswer(w){
    // If color exists: require "answer + color" (e.g. "un t-shirt rouge")
    if(w.color) return `${w.answer} ${w.color}`;
    return w.answer;
  }

  function renderEmoji(){
    elEmojiGrid.innerHTML = "";

    EMOJI_WORDS.forEach(w => {
      const card = document.createElement("div");
      card.className = "ec";

      const em = document.createElement("div");
      em.className = "emo";
      em.textContent = w.emoji;

      const colorRow = document.createElement("div");
      colorRow.className = "colorPair";

      if(w.color){
        const dot = document.createElement("span");
        dot.className = "colorDotSmall";
        dot.style.background = colorByFr[w.color] || "#fff";

        const lab = document.createElement("span");
        lab.className = "pill";
        lab.textContent = `Farge: ${w.color}`;

        colorRow.appendChild(dot);
        colorRow.appendChild(lab);
      }else{
        const lab = document.createElement("span");
        lab.className = "pill";
        lab.textContent = "Ingen farge i denne";
        colorRow.appendChild(lab);
      }

      const no = document.createElement("div");
      no.className = "noHint" + (showNoHint ? " show" : "");
      no.textContent = `Norsk: ${w.no}`;

      const input = document.createElement("input");
      input.type = "text";
      input.autocomplete = "off";
      input.spellcheck = false;
      input.placeholder = w.color ? "Skriv fransk + farge‚Ä¶" : "Skriv fransk‚Ä¶";
      input.value = emojiState[w.id] ?? "";
      input.dataset.wordId = w.id;

      const fb = document.createElement("div");
      fb.className = "fb";
      fb.dataset.fbFor = w.id;

      input.addEventListener("input", () => {
        emojiState[w.id] = input.value;
        saveEmojiState();
        input.style.borderColor = "rgba(255,255,255,.16)";
        fb.textContent = "";
      });

      card.appendChild(em);
      card.appendChild(colorRow);
      card.appendChild(no);
      card.appendChild(input);
      card.appendChild(fb);

      elEmojiGrid.appendChild(card);
    });

    btnToggleNo.textContent = showNoHint ? "Skjul norsk hint" : "Vis norsk hint";
  }

  function checkEmojiAll(){
    let correct = 0;
    let filled = 0;

    EMOJI_WORDS.forEach(w => {
      const input = elEmojiGrid.querySelector(`input[data-word-id="${w.id}"]`);
      const fb = elEmojiGrid.querySelector(`[data-fb-for="${w.id}"]`);

      const user = input.value;
      if(norm(user).length) filled++;

      const exp = expectedAnswer(w);
      const ok = norm(user) === norm(exp);

      if(ok){
        correct++;
        input.style.borderColor = "rgba(55,214,122,.65)";
        fb.textContent = "Riktig ‚úÖ";
        fb.style.color = "rgba(55,214,122,.95)";
      }else{
        input.style.borderColor = "rgba(255,92,92,.65)";
        fb.textContent = user.trim() ? "Feil ‚ùå" : "Tomt felt‚Ä¶";
        fb.style.color = "rgba(255,92,92,.95)";
      }
    });

    if(filled === 0){
      setEmojiStatus("Skriv noe f√∏rst üôÇ", "bad");
      return;
    }
    if(correct === EMOJI_WORDS.length){
      setEmojiStatus(`Perfekt! ${correct}/${EMOJI_WORDS.length} riktig üéâ`, "good");
    }else{
      setEmojiStatus(`${correct}/${EMOJI_WORDS.length} riktig. Rett de r√∏de feltene.`, correct > 0 ? null : "bad");
    }
  }

  function hintEmoji(){
    // For empty fields: put first character + ellipsis, based on expected answer
    let did = 0;
    EMOJI_WORDS.forEach(w => {
      const input = elEmojiGrid.querySelector(`input[data-word-id="${w.id}"]`);
      if(!input.value.trim()){
        const exp = expectedAnswer(w).trim();
        input.value = exp.charAt(0) + "‚Ä¶";
        emojiState[w.id] = input.value;
        did++;
      }
    });
    saveEmojiState();
    setEmojiStatus(did ? `Hint lagt inn i ${did} felt.` : "Alle felt har allerede tekst.", null);
  }

  function revealEmoji(){
    EMOJI_WORDS.forEach(w => {
      const input = elEmojiGrid.querySelector(`input[data-word-id="${w.id}"]`);
      input.value = expectedAnswer(w);
      emojiState[w.id] = input.value;
    });
    saveEmojiState();
    setEmojiStatus("Fasit fylt inn. Trykk Sjekk for gr√∏nt.", null);
  }

  function resetEmoji(){
    emojiState = {};
    saveEmojiState();
    renderEmoji();
    setEmojiStatus("Nullstilt.", null);
  }

  btnToggleNo.addEventListener("click", () => {
    showNoHint = !showNoHint;
    localStorage.setItem(LS_EMOJI_HINT, showNoHint ? "1" : "0");
    renderEmoji();
  });

  btnEmojiCheck.addEventListener("click", checkEmojiAll);
  btnEmojiHint.addEventListener("click", hintEmoji);
  btnEmojiReveal.addEventListener("click", revealEmoji);
  btnEmojiReset.addEventListener("click", resetEmoji);

  // init task 2
  renderEmoji();

})();
</script>
</body>
</html>
