<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Salut 9 ¬∑ Kapittel 4 ¬∑ V√™tements</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <header class="topbar">
    <div class="brand">
      Salut 9 <small>Kapittel 4</small>
    </div>
    <div class="pills">
      <span class="badge" id="scoreBadge">‚úÖ Treff: 0</span>
      <a class="btn" href="index.html">‚Üê Til meny</a>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <div>
        <h1>üëï V√™tements & couleurs</h1>
        <p>Tren gloser for kl√¶r og farger ‚Äì og skriv sm√• beskrivelser med tilbakemelding.</p>
      </div>
      <div style="min-width:260px; width:360px; max-width:100%;">
        <div class="small" style="display:flex; justify-content:space-between; margin-bottom:6px;">
          <span>Fremdrift</span><span id="progressText">0%</span>
        </div>
        <div class="progress"><div id="progressBar"></div></div>
        <div class="small" style="margin-top:6px;">Tips: Trykk <b>Ferdig</b> for √• f√• score og tilbakemelding.</div>
      </div>
    </section>

    <section class="card">
      <h2>üéØ M√•l</h2>
      <div class="grid">
        <div class="toast">
          <b>Jeg kan‚Ä¶</b>
          <ul class="small" style="margin:8px 0 0; padding-left:18px;">
            <li>navn p√• vanlige <b>kl√¶r</b> p√• fransk</li>
            <li>navn p√• vanlige <b>farger</b> p√• fransk</li>
            <li>beskrive antrekk: <b>Je porte‚Ä¶</b></li>
          </ul>
        </div>
        <div class="toast">
          <b>Viktig</b>
          <p class="small" style="margin:8px 0 0;">
            Denne siden bruker bare knapper, dropdowns og tekstfelt ‚Äì stabilt p√• iPad/PC.
          </p>
        </div>
      </div>

      <div class="nav">
        <a class="btn" href="meteo.html">La m√©t√©o</a>
        <a class="btn" href="passe_avoir.html">Pass√© compos√© (avoir)</a>
        <a class="btn" href="negation.html">N√©gation</a>
        <a class="btn" href="defi.html">D√©fi</a>
      </div>
    </section>

    <!-- 1) ORDBANK -->
    <section class="card" id="sectionVocab">
      <h2>1) Ordbank</h2>
      <div class="grid">
        <div class="toast">
          <b>üëö Kl√¶r</b>
          <div id="vocabClothes" class="small" style="margin-top:8px; line-height:1.6;"></div>
        </div>
        <div class="toast">
          <b>üé® Farger</b>
          <div id="vocabColors" class="small" style="margin-top:8px; line-height:1.6;"></div>
        </div>
      </div>
      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <button class="btn" id="toggleNo">Vis/Skjul norsk</button>
        <button class="btn" id="shuffleAll">Bland rekkef√∏lge</button>
      </div>
    </section>

    <!-- 2) QUIZLET-LIGNENDE: FLASHCARDS -->
    <section class="card" id="sectionCards">
      <h2>2) Flashcards (Quizlet-stil)</h2>
      <p class="small">Klikk kortet for √• snu. Trykk deretter om du hadde rett.</p>

      <div class="toast" style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center;">
        <div style="font-weight:900;">Kort <span id="cardIdx">1</span> / <span id="cardTotal">0</span></div>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="btn" id="prevCard">‚Üê Forrige</button>
          <button class="btn btn-primary" id="flipCard">Snu</button>
          <button class="btn" id="nextCard">Neste ‚Üí</button>
        </div>
      </div>

      <div class="toast" id="cardBox" style="margin-top:10px; text-align:center; padding:18px;">
        <div class="small" id="cardHint" style="opacity:.8; margin-bottom:8px;">Trykk ‚ÄúSnu‚Äù eller klikk kortet</div>
        <div id="cardFront" style="font-size:26px; font-weight:1000;">‚Äî</div>
        <div id="cardBack" class="small" style="display:none; margin-top:10px; font-weight:900;">‚Äî</div>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <button class="btn btn-success" id="cardRight">Jeg kunne det ‚úÖ</button>
        <button class="btn btn-danger" id="cardWrong">Jeg bommet ‚ùå</button>
      </div>

      <div class="toast" id="cardsToast" style="display:none; margin-top:10px;"></div>
    </section>

    <!-- 3) MATCHING (iPad-safe): EMOJI + DROPDOWN -->
    <section class="card" id="sectionMatch">
      <h2>3) Match: emoji ‚Üí ord</h2>
      <p class="small">Velg riktig fransk ord i dropdown. Trykk <b>Sjekk</b> for tilbakemelding.</p>

      <div id="matchRoot"></div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <button class="btn btn-primary" id="checkMatch">Sjekk</button>
        <button class="btn" id="resetMatch">Nullstill</button>
      </div>

      <p id="matchScore" style="margin:10px 0 0; font-weight:900;"></p>
      <div class="toast" id="matchToast" style="display:none; margin-top:10px;"></div>
    </section>

    <!-- 4) SKRIVING + TILBAKEMELDING -->
    <section class="card" id="sectionWrite">
      <h2>4) Skriv: jeg + sidemann + dr√∏mmeantrekk</h2>
      <p class="small">
        Bruk <b>Je porte‚Ä¶</b> / <b>Il/Elle porte‚Ä¶</b>. Bruk s√• mange gloser du klarer (kl√¶r + farger).
      </p>

      <div class="grid">
        <div class="toast">
          <b>A) Beskriv deg selv</b>
          <textarea class="input" id="textMe" rows="5" placeholder="Ex: Je porte un T-shirt noir et un pantalon bleu‚Ä¶"></textarea>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn btn-primary" data-finish="me">Ferdig</button>
            <button class="btn" data-clear="me">T√∏m</button>
          </div>
          <p class="small" id="fbMe" style="margin-top:8px;"></p>
        </div>

        <div class="toast">
          <b>B) Beskriv sidemannen</b>
          <textarea class="input" id="textFriend" rows="5" placeholder="Ex: Il porte‚Ä¶ / Elle porte‚Ä¶"></textarea>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn btn-primary" data-finish="friend">Ferdig</button>
            <button class="btn" data-clear="friend">T√∏m</button>
          </div>
          <p class="small" id="fbFriend" style="margin-top:8px;"></p>
        </div>

        <div class="toast">
          <b>C) Dr√∏mmeantrekk</b>
          <textarea class="input" id="textDream" rows="5" placeholder="Ex: Je porte‚Ä¶ parce que‚Ä¶"></textarea>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn btn-primary" data-finish="dream">Ferdig</button>
            <button class="btn" data-clear="dream">T√∏m</button>
          </div>
          <p class="small" id="fbDream" style="margin-top:8px;"></p>
        </div>

        <div class="toast">
          <b>üßæ Samle alt</b>
          <p class="small" style="margin-top:8px;">Trykk for √• samle tekstene og kopiere til innlevering.</p>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
            <button class="btn btn-success" id="saveAll">Lagre lokalt</button>
            <button class="btn btn-primary" id="copyAll">Kopier alt</button>
            <button class="btn btn-danger" id="resetAll">Nullstill alt</button>
          </div>
          <div class="toast" id="allToast" style="display:none; margin-top:10px;"></div>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>üèÅ Ferdig?</h2>
      <p class="small">G√• videre n√•r du har pr√∏vd alle delene.</p>
      <div class="nav">
        <a class="btn" href="index.html">Til meny</a>
      </div>
    </section>
  </main>

<script>
(() => {
  // =========================================================
  // 0) GLOSER ‚Äì OPPDATER HER s√• de matcher dine eksisterende
  // =========================================================
  // Tips: bruk akkurat samme skrivem√•te (aksenter, artikkel)
  const CLOTHES = [
    { fr: "un T-shirt", no: "en t-skjorte", emoji:"üëï" },
    { fr: "un pull", no: "en genser", emoji:"üß∂" },
    { fr: "une chemise", no: "en skjorte", emoji:"üëî" },
    { fr: "un pantalon", no: "en bukse", emoji:"üëñ" },
    { fr: "un short", no: "en shorts", emoji:"ü©≥" },
    { fr: "une jupe", no: "et skj√∏rt", emoji:"üëó" },
    { fr: "une robe", no: "en kjole", emoji:"üëó" },
    { fr: "une veste", no: "en jakke", emoji:"üß•" },
    { fr: "un manteau", no: "en k√•pe", emoji:"üß•" },
    { fr: "des chaussures", no: "sko", emoji:"üëü" },
    { fr: "des baskets", no: "joggesko", emoji:"üëü" },
    { fr: "des bottes", no: "st√∏vler", emoji:"ü•æ" },
    { fr: "un chapeau", no: "en hatt", emoji:"üé©" },
    { fr: "une casquette", no: "en caps", emoji:"üß¢" }
  ];

  const COLORS = [
    { fr: "noir", no: "svart", emoji:"‚¨õ" },
    { fr: "blanc", no: "hvit", emoji:"‚¨ú" },
    { fr: "rouge", no: "r√∏d", emoji:"üü•" },
    { fr: "bleu", no: "bl√•", emoji:"üü¶" },
    { fr: "vert", no: "gr√∏nn", emoji:"üü©" },
    { fr: "jaune", no: "gul", emoji:"üü®" },
    { fr: "rose", no: "rosa", emoji:"ü©∑" },
    { fr: "violet", no: "lilla", emoji:"üü™" },
    { fr: "gris", no: "gr√•", emoji:"ü©∂" },
    { fr: "marron", no: "brun", emoji:"üü´" }
  ];

  // =========================================================
  // 1) Helpers
  // =========================================================
  const $ = (id) => document.getElementById(id);

  const norm = (s) => (s || "")
    .toLowerCase()
    .replace(/\s+/g, " ")
    .replace(/[‚Äô']/g, "'")
    .replace(/[.,!?;:()]/g, "")
    .trim();

  function toast(el, msg){
    if (!el) return;
    el.style.display = "block";
    el.textContent = msg;
    clearTimeout(el._t);
    el._t = setTimeout(() => { el.style.display = "none"; }, 1600);
  }

  function shuffle(arr){
    const a = arr.slice();
    for (let i=a.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function uniq(arr){ return [...new Set(arr)]; }

  // Progress (3 deler: cards, match, writing) + vocab er ‚Äúinfo‚Äù
  const DONE_KEY = "vetements_done_v1";
  function getDone(){ return JSON.parse(localStorage.getItem(DONE_KEY) || "{}"); }
  function setDone(part){
    const d = getDone();
    d[part] = true;
    localStorage.setItem(DONE_KEY, JSON.stringify(d));
    updateProgress();
  }
  function updateProgress(){
    const d = getDone();
    const parts = [!!d.cards, !!d.match, !!d.write, true];
    const pct = Math.round((parts.filter(Boolean).length / parts.length) * 100);
    $("progressText").textContent = pct + "%";
    $("progressBar").style.width = pct + "%";
  }

  // Score badge: totalt ‚Äútreff‚Äù fra cards (riktig), match (riktig) og writing (glosetreff)
  let totalScore = Number(localStorage.getItem("vetements_score_v1") || "0");
  function setScore(v){
    totalScore = Math.max(0, v);
    localStorage.setItem("vetements_score_v1", String(totalScore));
    $("scoreBadge").textContent = `‚úÖ Treff: ${totalScore}`;
  }
  function addScore(delta){
    setScore(totalScore + delta);
  }
  setScore(totalScore);
  updateProgress();

  // =========================================================
  // 2) Ordbank render + toggle norsk
  // =========================================================
  let showNO = true;
  let clothesView = CLOTHES.slice();
  let colorsView = COLORS.slice();

  function renderVocab(){
    const clothes = clothesView.map(w =>
      `‚Ä¢ ${w.emoji} <b>${w.fr}</b>` + (showNO ? ` ‚Äî ${w.no}` : "")
    ).join("<br>");
    const colors = colorsView.map(w =>
      `‚Ä¢ ${w.emoji} <b>${w.fr}</b>` + (showNO ? ` ‚Äî ${w.no}` : "")
    ).join("<br>");

    $("vocabClothes").innerHTML = clothes;
    $("vocabColors").innerHTML = colors;
  }

  $("toggleNo").addEventListener("click", () => {
    showNO = !showNO;
    renderVocab();
  });

  $("shuffleAll").addEventListener("click", () => {
    clothesView = shuffle(clothesView);
    colorsView = shuffle(colorsView);
    renderVocab();
    toast($("cardsToast"), "üîÄ Blandet!");
  });

  renderVocab();

  // =========================================================
  // 3) Flashcards (Quizlet-ish)
  // =========================================================
  const ALL = CLOTHES.map(x => ({...x, type:"clothes"}))
    .concat(COLORS.map(x => ({...x, type:"colors"}));
  let cards = shuffle(ALL);
  let cardIndex = 0;
  let flipped = false;

  $("cardTotal").textContent = String(cards.length);

  function renderCard(){
    const c = cards[cardIndex];
    $("cardIdx").textContent = String(cardIndex + 1);
    $("cardFront").textContent = c.fr;
    $("cardBack").textContent = `${c.emoji} ${c.no}`;
    $("cardBack").style.display = flipped ? "block" : "none";
    $("cardHint").textContent = flipped ? "Trykk ‚úÖ/‚ùå" : "Trykk ‚ÄúSnu‚Äù eller klikk kortet";
  }

  function flip(){
    flipped = !flipped;
    renderCard();
  }

  $("flipCard").addEventListener("click", flip);
  $("cardBox").addEventListener("click", flip);

  $("prevCard").addEventListener("click", () => {
    cardIndex = (cardIndex - 1 + cards.length) % cards.length;
    flipped = false;
    renderCard();
  });
  $("nextCard").addEventListener("click", () => {
    cardIndex = (cardIndex + 1) % cards.length;
    flipped = false;
    renderCard();
  });

  $("cardRight").addEventListener("click", () => {
    if (!flipped) flip();
    addScore(1);
    toast($("cardsToast"), "‚úÖ Bra!");
    if (cardIndex === cards.length - 1) setDone("cards");
    $("nextCard").click();
  });

  $("cardWrong").addEventListener("click", () => {
    if (!flipped) flip();
    toast($("cardsToast"), "‚ùå Not√©r og pr√∏v igjen");
    $("nextCard").click();
  });

  renderCard();

  // =========================================================
  // 4) Match: emoji -> fr (dropdown) (iPad-safe)
  // =========================================================
  const MATCH_KEY = "vetements_match_v1";
  const matchRoot = $("matchRoot");

  const matchItems = shuffle(CLOTHES).slice(0, 8).map(w => ({
    prompt: `${w.emoji} ${w.no}`,
    answer: w.fr
  }));

  const options = shuffle(CLOTHES.map(w => w.fr)); // kun kl√¶r her (bevisst)

  function renderMatch(){
    const saved = JSON.parse(localStorage.getItem(MATCH_KEY) || "{}");
    matchRoot.innerHTML = "";

    matchItems.forEach((it, i) => {
      const row = document.createElement("div");
      row.className = "toast";
      row.style.display = "grid";
      row.style.gridTemplateColumns = "1fr 1fr";
      row.style.gap = "10px";
      row.style.alignItems = "center";
      row.style.margin = "10px 0";

      const left = document.createElement("div");
      left.innerHTML = `<b>${i+1}.</b> <span class="small">${it.prompt}</span>`;

      const sel = document.createElement("select");
      sel.className = "input";
      const ph = document.createElement("option");
      ph.value = "";
      ph.textContent = "Velg fransk ord‚Ä¶";
      sel.appendChild(ph);
      options.forEach(o => {
        const opt = document.createElement("option");
        opt.value = o;
        opt.textContent = o;
        sel.appendChild(opt);
      });
      sel.value = saved["m_"+i] || "";

      row.appendChild(left);
      row.appendChild(sel);
      matchRoot.appendChild(row);
    });

    $("matchScore").textContent = "";
  }

  function checkMatch(){
    const rows = [...matchRoot.querySelectorAll(".toast")];
    let ok = 0;

    rows.forEach((row, i) => {
      const sel = row.querySelector("select");
      const isOk = norm(sel.value) === norm(matchItems[i].answer);
      sel.style.outline = sel.value
        ? (isOk ? "2px solid var(--success)" : "2px solid var(--danger)")
        : "";
      if (isOk) ok++;
    });

    $("matchScore").textContent = `Treff: ${ok} / ${matchItems.length}`;
    toast($("matchToast"), ok === matchItems.length ? "‚úÖ Perfekt!" : "üìå Se etter r√∏de felt og pr√∏v igjen.");
    addScore(ok); // bel√∏nn for riktige (enkelt + motiverende)
    if (ok === matchItems.length) setDone("match");

    // lagre valg
    const data = {};
    rows.forEach((row, i) => data["m_"+i] = row.querySelector("select").value);
    localStorage.setItem(MATCH_KEY, JSON.stringify(data));
  }

  $("checkMatch").addEventListener("click", checkMatch);
  $("resetMatch").addEventListener("click", () => {
    localStorage.removeItem(MATCH_KEY);
    renderMatch();
    toast($("matchToast"), "üßπ Nullstilt!");
  });

  renderMatch();

  // =========================================================
  // 5) Skriving med tilbakemelding (tell riktige gloser brukt)
  // =========================================================
  const WRITE_KEY = "vetements_write_v1";

  const allWordsFR = CLOTHES.map(x => x.fr).concat(COLORS.map(x => x.fr));
  const allWordsNorm = allWordsFR.map(w => norm(w));

  function countVocabHits(text){
    const t = norm(text);

    // teller ‚Äúhele uttrykk‚Äù ‚Äì enklest robust: sjekk substring p√• normalisert tekst
    const used = allWordsNorm.filter(w => t.includes(w));
    const uniqueUsed = uniq(used);

    // gi ogs√• litt ‚Äúr√•d‚Äù
    const clothesUsed = uniq(CLOTHES.map(x => norm(x.fr)).filter(w => t.includes(w))).length;
    const colorsUsed = uniq(COLORS.map(x => norm(x.fr)).filter(w => t.includes(w))).length;

    return { total: uniqueUsed.length, clothesUsed, colorsUsed, list: uniqueUsed };
  }

  function feedbackText(hits){
    // niv√•er (kan justeres)
    if (hits.total >= 10) return `üî• Kjempebra! Du brukte ${hits.total} gloser (kl√¶r: ${hits.clothesUsed}, farger: ${hits.colorsUsed}).`;
    if (hits.total >= 6) return `‚úÖ Bra! Du brukte ${hits.total} gloser (kl√¶r: ${hits.clothesUsed}, farger: ${hits.colorsUsed}). Pr√∏v √• legge til 1‚Äì2 farger til.`;
    if (hits.total >= 3) return `üëç P√• vei! Du brukte ${hits.total} gloser. Legg inn flere kl√¶r + minst 2 farger.`;
    return `üìå Du brukte ${hits.total} gloser. Tips: start med ‚ÄúJe porte‚Ä¶‚Äù + 2‚Äì3 plagg + 2 farger.`;
  }

  function finish(which){
    const map = {
      me: { ta: $("textMe"), fb: $("fbMe") },
      friend: { ta: $("textFriend"), fb: $("fbFriend") },
      dream: { ta: $("textDream"), fb: $("fbDream") }
    };
    const item = map[which];
    if (!item) return;

    const hits = countVocabHits(item.ta.value);
    item.fb.textContent = feedbackText(hits);

    // bel√∏nn ‚Äúantall gloser‚Äù (men uten √• eksplodere score)
    addScore(Math.min(5, hits.total)); // maks 5 per ferdig-trykk

    // mark write done hvis de har minst 6 gloser i minst √©n tekst
    if (hits.total >= 6) setDone("write");
  }

  function clearOne(which){
    const map = {
      me: { ta: $("textMe"), fb: $("fbMe") },
      friend: { ta: $("textFriend"), fb: $("fbFriend") },
      dream: { ta: $("textDream"), fb: $("fbDream") }
    };
    const item = map[which];
    if (!item) return;
    item.ta.value = "";
    item.fb.textContent = "";
  }

  document.querySelectorAll("[data-finish]").forEach(btn => {
    btn.addEventListener("click", () => finish(btn.getAttribute("data-finish")));
  });

  document.querySelectorAll("[data-clear]").forEach(btn => {
    btn.addEventListener("click", () => clearOne(btn.getAttribute("data-clear")));
  });

  function saveAll(){
    const data = {
      me: $("textMe").value,
      friend: $("textFriend").value,
      dream: $("textDream").value
    };
    localStorage.setItem(WRITE_KEY, JSON.stringify(data));
    toast($("allToast"), "‚úÖ Lagret lokalt!");
  }

  function loadAll(){
    const raw = localStorage.getItem(WRITE_KEY);
    if (!raw) return;
    try{
      const data = JSON.parse(raw);
      $("textMe").value = data.me || "";
      $("textFriend").value = data.friend || "";
      $("textDream").value = data.dream || "";
    }catch(e){}
  }

  function copyAll(){
    const parts = [
      $("textMe").value.trim(),
      $("textFriend").value.trim(),
      $("textDream").value.trim()
    ].filter(Boolean);

    const out = parts.join("\n\n");
    if (!out) return;

    navigator.clipboard.writeText(out).then(() => {
      toast($("allToast"), "üìã Kopiert!");
    }).catch(() => {
      const ta = document.createElement("textarea");
      ta.value = out;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      toast($("allToast"), "üìã Kopiert!");
    });
  }

  function resetAll(){
    localStorage.removeItem(WRITE_KEY);
    localStorage.removeItem(MATCH_KEY);
    localStorage.removeItem(DONE_KEY);
    setScore(0);
    $("textMe").value = "";
    $("textFriend").value = "";
    $("textDream").value = "";
    $("fbMe").textContent = "";
    $("fbFriend").textContent = "";
    $("fbDream").textContent = "";
    renderMatch();
    updateProgress();
    toast($("allToast"), "üßπ Alt er nullstilt!");
  }

  $("saveAll").addEventListener("click", saveAll);
  $("copyAll").addEventListener("click", copyAll);
  $("resetAll").addEventListener("click", resetAll);

  loadAll();
})();
</script>
</body>
</html>
